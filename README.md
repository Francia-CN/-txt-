======================================================================
# 多格式文档批量转换工具 (v1.0)
======================================================================

一个高效、健壮、可扩展的命令行工具，用于将多种格式的文档（如 EPUB, MOBI, PDF, DOCX）批量转换为纯文本（.txt）文件。

## ✨ 主要特性

- **一键启动 (Windows)**: 内置强大的 `run.bat` 启动器，可自动检查环境、支持拖拽操作并提供交互式安全提示，无需任何命令行知识。
- **多格式支持**: 原生支持对 `.epub`, `.docx`, `.pdf` 格式的文本提取，并可借助 Calibre 环境支持 `.mobi` 和 `.azw3` 等更多电子书格式。
- **高性能**: 利用多进程并行处理，能充分利用现代多核 CPU 的性能，大幅缩短大批量文件的转换时间。
- **高度健壮**: 对加密文件、内容为空、格式不规范等异常情况有良好的处理和回退机制，确保单个文件的失败不影响整体任务。
- **用户友好**:
  - **实时进度**: 提供实时进度条（tqdm），直观展示处理进度。
  - **彩色输出**: 在终端使用彩色状态输出，转换结果一目了然。
  - **详细日志**: 为每次运行生成详细的日志报告，并支持自定义日志级别。
- **灵活配置**: 支持通过命令行参数自定义并发进程数、超时时间、文件过滤等。
- **安全可靠**: 对于清空输出目录等危险操作，会进行交互式二次确认，防止意外数据丢失。

## 🚀 Windows 快速入门 (使用 run.bat)

我们为 Windows 用户提供了 `run.bat` 一键启动脚本，您可以通过以下两种方式轻松使用：

### 方法一：双击运行 (推荐)

1.  **准备文件**: 将所有需要转换的文档放入项目根目录下的 `input` 文件夹。
2.  **双击运行**: 直接双击 `run.bat` 文件。
3.  **交互确认**: 如果 `output` 目录已存在，脚本会提示您是否要清空它。
4.  **自动完成**: 脚本将自动开始转换。完成后，会自动打开存放结果的 `output` 文件夹。

### 方法二：拖拽文件夹

1.  **拖拽操作**: 将任意一个包含待转换文档的文件夹，用鼠标拖到 `run.bat` 文件的图标上，然后松开。
2.  **自动处理**: 脚本会自动处理您拖拽的文件夹，并在其旁边创建一个 `原文件夹名_output` 的新文件夹来存放结果。

## 📚 支持格式

| 格式 | 依赖库/工具 | 处理方式 |
| :--- | :--- | :--- |
| `.epub` | `lxml`, `beautifulsoup4` | **转换为 .txt** (内置解析器) |
| `.docx` | `python-docx` | **转换为 .txt** (内置解析器) |
| `.pdf` | `PyMuPDF` | **转换为 .txt** (内置解析器) |
| `.mobi` | Calibre | **转换为 .txt** (调用 `ebook-convert`) |
| `.azw3` | Calibre | **转换为 .txt** (调用 `ebook-convert`) |
| 其他格式 | _无_ | **直接复制**到输出目录 |

## ⚙️ 环境要求与安装

### 步骤 1: 安装 Python
确保您已安装 Python 3.7+。安装时，务必勾选 **"Add Python to PATH"** 选项。

### 步骤 2: 安装 Python 依赖库
在项目根目录下打开命令行，运行：
```bash
pip install -r requirements.txt
```

### 步骤 3: 安装 Calibre (可选)
如需转换 `.mobi` 或 `.azw3`，请安装 Calibre 并确保其在系统 `PATH` 环境变量中。

## ⌨️ 命令行高级用法 (跨平台)

**基本用法**:
```bash
python run.py
```

**指定目录，使用8个进程并清空输出目录**:
```bash
python run.py ./books ./texts -t 8 --clean-output
```

**只转换PDF和EPUB，并以最详细的模式记录日志**:
```bash
python run.py ./in ./out --include .pdf,.epub --log-level DEBUG
```

### 命令行参数详解

| 参数 | 别名 | 类型 | 默认值 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| `input` | | `string` | `input` | 输入目录的路径。 |
| `output` | | `string` | `output` | 输出目录的路径。 |
| `--threads` | `-t` | `int` | CPU核心数 | 用于处理文件的并发进程数量。 |
| `--timeout` | | `int` | `120` | 单个文件的最大处理时间（秒）。 |
| `--clean-output` | | `flag` | `False` | **危险!** 开始前清空已存在的输出目录。 |
| `--include` | | `string` | `None` | 只处理指定后缀的文件 (例: `.epub,.pdf`)。 |
| `--exclude` | | `string` | `None` | 排除指定后缀的文件 (例: `.jpg,.zip`)。 |
| `--log-level` | | `string` | `INFO` | 设置日志级别 (`DEBUG`, `INFO`, `WARNING`, `ERROR`)。 |
| `--no-color` | | `flag` | `False` | 禁用所有彩色的控制台输出。 |
| `--help` | `-h` | `flag` | | 显示帮助信息并退出。 |

---
